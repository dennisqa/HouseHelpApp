<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domestic Services App - Connect Domestic Workers with Employers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
        * { box-sizing: border-box; }
        .mobile-container { max-width: 480px; margin: 0 auto; min-height: 100vh; background: white; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        @media (max-width: 480px) { .mobile-container { box-shadow: none; } }
        .camera-container { position: relative; width: 100%; max-width: 300px; margin: 0 auto; }
        .camera-preview { width: 100%; border-radius: 8px; border: 2px solid #e5e7eb; }
        .camera-controls { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
        .id-preview { max-width: 100%; max-height: 200px; object-fit: contain; border-radius: 8px; border: 2px solid #e5e7eb; }
    </style>
</head>
<body>
    <div id="root">Loading...</div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Icons
        const HomeIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>);
        const BriefcaseIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>);
        const MessageIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>);
        const UserIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>);
        const PlusIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>);
        const ArrowLeftIcon = ({ onClick }) => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="cursor-pointer" onClick={onClick}><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>);
        const SendIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22,2 15,22 11,13 2,9 22,2"/></svg>);
        const CameraIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>);
        const EditIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>);
        const LogOutIcon = () => (<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>);

        // API Service
        const API_BASE_URL = '/.netlify/functions';
        const ApiService = {
            makeRequest: async (url, options = {}) => {
                try {
                    const response = await fetch(url, { ...options, headers: { 'Content-Type': 'application/json', ...options.headers } });
                    const responseText = await response.text();
                    if (!response.ok) throw new Error(JSON.parse(responseText).error || `HTTP ${response.status}`);
                    return JSON.parse(responseText);
                } catch (error) { throw error; }
            },
            register: async (userData) => await ApiService.makeRequest(`${API_BASE_URL}/users?action=register`, { method: 'POST', body: JSON.stringify(userData) }),
            login: async (credentials) => await ApiService.makeRequest(`${API_BASE_URL}/users?action=login`, { method: 'POST', body: JSON.stringify(credentials) }),
            getWorkers: async () => await ApiService.makeRequest(`${API_BASE_URL}/users?action=workers`),
            getJobs: async (employerId = null) => await ApiService.makeRequest(employerId ? `${API_BASE_URL}/jobs?employer_id=${employerId}` : `${API_BASE_URL}/jobs`),
            createJob: async (jobData) => await ApiService.makeRequest(`${API_BASE_URL}/jobs`, { method: 'POST', body: JSON.stringify(jobData) }),
            getConversations: async (userId) => await ApiService.makeRequest(`${API_BASE_URL}/conversations?user_id=${userId}`),
            createConversation: async (conversationData) => await ApiService.makeRequest(`${API_BASE_URL}/conversations`, { method: 'POST', body: JSON.stringify(conversationData) }),
            getMessages: async (conversationId) => await ApiService.makeRequest(`${API_BASE_URL}/messages?conversation_id=${conversationId}`),
            sendMessage: async (messageData) => await ApiService.makeRequest(`${API_BASE_URL}/messages`, { method: 'POST', body: JSON.stringify(messageData) })
        };

        // Camera Component
        const CameraCapture = ({ onCapture, onClose }) => {
            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const [stream, setStream] = useState(null);
            const [error, setError] = useState('');

            useEffect(() => {
                const startCamera = async () => {
                    try {
                        const mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user', width: { ideal: 300 }, height: { ideal: 300 } } });
                        if (videoRef.current) videoRef.current.srcObject = mediaStream;
                        setStream(mediaStream);
                    } catch (err) { setError('Camera access denied. Please allow camera access and try again.'); }
                };
                startCamera();
                return () => { if (stream) stream.getTracks().forEach(track => track.stop()); };
            }, []);

            const capturePhoto = () => {
                const video = videoRef.current;
                const canvas = canvasRef.current;
                const context = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0);
                canvas.toBlob((blob) => {
                    const reader = new FileReader();
                    reader.onload = () => onCapture(reader.result);
                    reader.readAsDataURL(blob);
                }, 'image/jpeg', 0.85);
                if (stream) stream.getTracks().forEach(track => track.stop());
                onClose();
            };

            if (error) {
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white p-6 rounded-lg max-w-sm mx-4">
                            <h3 className="text-lg font-bold text-red-600 mb-4">Camera Error</h3>
                            <p className="text-gray-600 mb-4">{error}</p>
                            <button onClick={onClose} className="w-full py-2 bg-red-600 text-white rounded-lg">Close</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white p-4 rounded-lg max-w-sm mx-4">
                        <h3 className="text-lg font-bold text-gray-800 mb-4 text-center">Take Profile Photo</h3>
                        <div className="camera-container">
                            <video ref={videoRef} autoPlay playsInline className="camera-preview" />
                            <canvas ref={canvasRef} style={{ display: 'none' }} />
                            <div className="camera-controls">
                                <button onClick={capturePhoto} className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Capture</button>
                                <button onClick={onClose} className="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [screen, setScreen] = useState("landing");
            const [userType, setUserType] = useState("employer");
            const [selectedWorker, setSelectedWorker] = useState(null);
            const [selectedConversation, setSelectedConversation] = useState(null);
            const [messageInput, setMessageInput] = useState("");
            const [messages, setMessages] = useState([]);
            const [loginCredentials, setLoginCredentials] = useState({ email: "", password: "" });
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([]);
            const [jobs, setJobs] = useState([]);
            const [conversations, setConversations] = useState([]);
            const [showCamera, setShowCamera] = useState(false);
            
            const [registrationForm, setRegistrationForm] = useState({
                name: "", age: "", email: "", phone: "", location: "", password: "", confirmPassword: "", about: "",
                skills: "", experience: "", availability: "", serviceArea: "", monthlySalary: "", jobType: "",
                profilePhoto: null, idDocument: null,
            });

            const [jobForm, setJobForm] = useState({
                title: "", skills: "", schedule: "", location: "", salary: "", description: "", jobType: "",
            });

            // Load data on login
            useEffect(() => {
                const loadData = async () => {
                    if (isLoggedIn && currentUser) {
                        try {
                            if (currentUser.user_type === 'employer') {
                                const workers = await ApiService.getWorkers();
                                setUsers(workers);
                            }
                            const jobs = await ApiService.getJobs();
                            setJobs(jobs);
                            const convos = await ApiService.getConversations(currentUser.id);
                            setConversations(convos);
                        } catch (error) { console.error('Error loading data:', error); }
                    }
                };
                loadData();
            }, [isLoggedIn, currentUser]);

            // Handlers
            const handleCameraCapture = (photoData) => {
                setRegistrationForm({ ...registrationForm, profilePhoto: photoData });
                setShowCamera(false);
            };

            const handleFileUpload = (e, fieldName) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => setRegistrationForm({ ...registrationForm, [fieldName]: e.target.result });
                    reader.readAsDataURL(file);
                }
            };

            const handleRegistrationFormChange = (e) => {
                const { name, value } = e.target;
                setRegistrationForm({ ...registrationForm, [name]: value });
            };

            const handleRegistration = async (type) => {
                const { name, age, email, phone, location, password, confirmPassword, about } = registrationForm;
                
                if (!name || !email || !phone || !location || !password) {
                    alert("Please fill in all required fields");
                    return;
                }

                if (type === "worker") {
                    if (!age || !registrationForm.skills || !registrationForm.experience || 
                        !registrationForm.availability || !registrationForm.monthlySalary || 
                        !registrationForm.jobType || !registrationForm.profilePhoto || !registrationForm.idDocument) {
                        alert("Please fill in all worker-specific fields including photo and ID document");
                        return;
                    }
                    if (age < 18 || age > 70) {
                        alert("Age must be between 18 and 70 years");
                        return;
                    }
                }
                
                if (password !== confirmPassword) {
                    alert("Passwords do not match");
                    return;
                }
                
                if (password.length < 6) {
                    alert("Password must be at least 6 characters long");
                    return;
                }
                
                try {
                    const userData = { name, email, phone, location, password, about, user_type: type };
                    
                    if (type === "worker") {
                        userData.age = parseInt(age);
                        userData.skills = registrationForm.skills;
                        userData.experience = registrationForm.experience;
                        userData.availability = registrationForm.availability;
                        userData.service_area = registrationForm.serviceArea || location;
                        userData.monthly_salary = registrationForm.monthlySalary;
                        userData.job_type = registrationForm.jobType;
                        userData.profile_photo_url = registrationForm.profilePhoto;
                        userData.id_document_url = registrationForm.idDocument;
                    }
                    
                    await ApiService.register(userData);
                    
                    setRegistrationForm({
                        name: "", age: "", email: "", phone: "", location: "", password: "", confirmPassword: "", about: "",
                        skills: "", experience: "", availability: "", serviceArea: "", monthlySalary: "", jobType: "",
                        profilePhoto: null, idDocument: null,
                    });
                    
                    alert("Account created successfully! Please login with your credentials.");
                    setScreen(type === "employer" ? "employerLogin" : "workerLogin");
                } catch (error) {
                    alert(error.message);
                }
            };

            const handleLogin = async () => {
                const { email, password } = loginCredentials;
                if (!email || !password) {
                    alert("Please enter both email and password");
                    return;
                }

                try {
                    const user = await ApiService.login({ email, password });
                    setCurrentUser(user);
                    setUserType(user.user_type);
                    setIsLoggedIn(true);
                    setScreen(user.user_type === "employer" ? "employerHome" : "workerHome");
                    setLoginCredentials({ email: "", password: "" });
                } catch (error) {
                    alert(error.message);
                }
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setCurrentUser(null);
                setUserType("employer");
                setLoginCredentials({ email: "", password: "" });
                setScreen("landing");
            };

            const selectWorker = (worker) => {
                setSelectedWorker(worker);
                setScreen("workerDetail");
            };

            const selectConversation = async (convo) => {
                try {
                    setSelectedConversation(convo);
                    const messages = await ApiService.getMessages(convo.id);
                    const transformedMessages = messages.map(msg => ({
                        ...msg,
                        sender: msg.sender_id === currentUser.id ? "me" : "other",
                        text: msg.message_text || msg.text,
                        time: new Date(msg.sent_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                    }));
                    setMessages(transformedMessages);
                    setScreen("chatDetail");
                } catch (error) {
                    console.error('Error loading messages:', error);
                    alert('Error loading messages: ' + error.message);
                }
            };

            const sendMessage = async () => {
                if (messageInput.trim() === "") return;

                try {
                    const messageData = {
                        conversation_id: selectedConversation.id,
                        sender_id: currentUser.id,
                        message_text: messageInput
                    };

                    await ApiService.sendMessage(messageData);
                    
                    const newMessage = {
                        id: Date.now(),
                        sender: "me",
                        text: messageInput,
                        time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                    };
                    
                    setMessages(prev => [...prev, newMessage]);
                    setMessageInput("");
                } catch (error) {
                    alert(error.message);
                }
            };

            const handleJobFormChange = (e) => {
                const { name, value } = e.target;
                setJobForm({ ...jobForm, [name]: value });
            };

            const simulatePayment = async () => {
                const paymentMethods = ["M-Pesa", "Credit Card", "Bank Transfer"];
                const selectedMethod = prompt("Select payment method:\n1. M-Pesa\n2. Credit Card\n3. Bank Transfer\n\nEnter 1, 2, or 3:");
                if (!selectedMethod || !["1", "2", "3"].includes(selectedMethod)) {
                    return { success: false, error: "Payment cancelled" };
                }
                await new Promise(resolve => setTimeout(resolve, 2000));
                const isSuccess = Math.random() > 0.05;
                return {
                    success: isSuccess,
                    transaction_id: isSuccess ? `TXN${Date.now()}` : null,
                    method: paymentMethods[parseInt(selectedMethod) - 1],
                    error: isSuccess ? null : "Payment processing failed"
                };
            };

            const handlePostJob = async () => {
                if (!jobForm.title || !jobForm.skills || !jobForm.schedule || !jobForm.location || !jobForm.salary || !jobForm.description || !jobForm.jobType) {
                    alert("Please fill in all required fields");
                    return;
                }

                const confirmPayment = confirm(`You are about to post a job for KSh 300.\n\nJob: ${jobForm.title}\nType: ${jobForm.jobType}\nLocation: ${jobForm.location}\n\nClick OK to proceed to payment.`);
                if (!confirmPayment) return;

                try {
                    const jobData = {
                        employer_id: currentUser?.id,
                        title: jobForm.title,
                        description: jobForm.description,
                        skills_required: jobForm.skills,
                        work_schedule: jobForm.schedule,
                        location: jobForm.location,
                        salary_range: jobForm.salary,
                        job_type: jobForm.jobType,
                        commission_amount: 300.00,
                        payment_status: 'pending'
                    };
                    
                    const paymentResult = await simulatePayment();
                    
                    if (paymentResult.success) {
                        jobData.payment_status = 'completed';
                        await ApiService.createJob(jobData);
                        const updatedJobs = await ApiService.getJobs();
                        setJobs(updatedJobs);
                        setJobForm({ title: "", skills: "", schedule: "", location: "", salary: "", description: "", jobType: "", });
                        alert("Payment successful! Your job has been posted and is now live.");
                        setScreen("employerHome");
                    } else {
                        alert("Payment failed. Please try again or contact support.");
                    }
                } catch (error) {
                    alert("Error posting job: " + error.message);
                }
            };

            const handleContactWorker = async (worker) => {
                const confirmPayment = confirm(`To contact ${worker.name}, you need to pay a one-time contact fee of KSh 200.\n\nThis fee allows you to:\n✓ Send direct messages to the worker\n✓ Share your contact information\n✓ Schedule interviews\n✓ Discuss job opportunities\n\nClick OK to proceed to payment.`);
                if (!confirmPayment) return;

                try {
                    const paymentResult = await simulatePayment();
                    
                    if (paymentResult.success) {
                        const conversationData = {
                            participant_1_id: currentUser?.id,
                            participant_2_id: worker.id,
                            initial_message: `Hi ${worker.name}, I'm interested in your services. Could we discuss a potential opportunity?`,
                            contact_fee_paid: true,
                            contact_fee_amount: 200.00,
                            payment_transaction_id: paymentResult.transaction_id
                        };
                        
                        await ApiService.createConversation(conversationData);
                        const updatedConversations = await ApiService.getConversations(currentUser.id);
                        setConversations(updatedConversations);
                        
                        const newConvo = updatedConversations.find(c => 
                            (c.participant_1_id === currentUser.id && c.participant_2_id === worker.id) ||
                            (c.participant_1_id === worker.id && c.participant_2_id === currentUser.id)
                        );
                        
                        if (newConvo) {
                            const messages = await ApiService.getMessages(newConvo.id);
                            const transformedMessages = messages.map(msg => ({
                                ...msg,
                                sender: msg.sender_id === currentUser.id ? "me" : "other",
                                text: msg.message_text || msg.text,
                                time: new Date(msg.sent_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                            }));
                            
                            setSelectedConversation({...newConvo, other_user_name: worker.name});
                            setMessages(transformedMessages);
                            setScreen("chatDetail");
                        }
                        
                        alert("Payment successful! You can now contact " + worker.name + ".");
                    } else {
                        alert("Payment failed. Please try again or contact support.");
                    }
                } catch (error) {
                    alert("Error processing contact request: " + error.message);
                }
            };

            const getWorkers = () => users.filter(user => user.user_type === "worker" && user.is_active);

            // Navigation Component
            const BottomNavigation = ({ activeScreen, onNavigate }) => (
                <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t border-gray-200">
                    <div className="flex justify-around items-center p-2">
                        <div className={`flex flex-col items-center cursor-pointer ${activeScreen === 'home' ? (userType === 'employer' ? 'text-blue-600' : 'text-green-600') : 'text-gray-500'}`} onClick={() => onNavigate('home')}>
                            <HomeIcon />
                            <span className="text-xs">Home</span>
                        </div>
                        <div className={`flex flex-col items-center cursor-pointer ${activeScreen === 'jobs' ? (userType === 'employer' ? 'text-blue-600' : 'text-green-600') : 'text-gray-500'}`} onClick={() => onNavigate('jobs')}>
                            <BriefcaseIcon />
                            <span className="text-xs">Jobs</span>
                        </div>
                        <div className={`flex flex-col items-center cursor-pointer ${activeScreen === 'messages' ? (userType === 'employer' ? 'text-blue-600' : 'text-green-600') : 'text-gray-500'}`} onClick={() => onNavigate('messages')}>
                            <MessageIcon />
                            <span className="text-xs">Messages</span>
                        </div>
                        <div className={`flex flex-col items-center cursor-pointer ${activeScreen === 'profile' ? (userType === 'employer' ? 'text-blue-600' : 'text-green-600') : 'text-gray-500'}`} onClick={() => onNavigate('profile')}>
                            <UserIcon />
                            <span className="text-xs">Profile</span>
                        </div>
                    </div>
                </div>
            );

            const handleBottomNavigation = (tab) => {
                switch(tab) {
                    case 'home':
                        setScreen(userType === "employer" ? "employerHome" : "workerHome");
                        break;
                    case 'jobs':
                        setScreen("jobs");
                        break;
                    case 'messages':
                        setScreen("messages");
                        break;
                    case 'profile':
                        setScreen(userType === "employer" ? "employerProfile" : "workerProfile");
                        break;
                }
            };

            // SCREENS - Landing Screen
            if (screen === "landing") {
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col items-center justify-center p-4 h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                            <div className="text-center">
                                <h1 className="text-4xl font-bold text-blue-600 mb-4">Domestic Services App</h1>
                                <p className="text-gray-600 mb-8 text-lg">Connect domestic workers with employers</p>
                                <div className="space-y-4 w-full max-w-xs">
                                    <button className="w-full py-4 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors shadow-lg" onClick={() => setScreen("createEmployerAccount")}>Create Account as Employer</button>
                                    <button className="w-full py-4 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors shadow-lg" onClick={() => setScreen("createWorkerAccount")}>Create Account as Domestic Worker</button>
                                    <div className="mt-6 pt-4 border-t border-gray-300">
                                        <p className="text-gray-600 text-sm mb-3">Already have an account?</p>
                                        <div className="space-y-2">
                                            <button className="w-full py-3 bg-white border-2 border-blue-600 text-blue-600 rounded-lg font-medium hover:bg-blue-50 transition-colors" onClick={() => setScreen("employerLogin")}>Login as Employer</button>
                                            <button className="w-full py-3 bg-white border-2 border-green-600 text-green-600 rounded-lg font-medium hover:bg-green-50 transition-colors" onClick={() => setScreen("workerLogin")}>Login as Domestic Worker</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Jobs Screen
            if (screen === "jobs") {
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col h-screen bg-gray-50">
                            <div className={`${userType === "employer" ? "bg-blue-600" : "bg-green-600"} p-4 text-white`}>
                                <h1 className="text-xl font-bold text-center">Jobs</h1>
                            </div>
                            <div className="flex-1 overflow-y-auto pb-20">
                                {userType === "employer" && (
                                    <div className="p-4">
                                        <button className="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors" onClick={() => setScreen("postJob")}>
                                            Post New Job
                                        </button>
                                    </div>
                                )}
                                <div className="px-4">
                                    <h3 className="text-lg font-bold text-gray-800 mb-3">
                                        {userType === "employer" ? "Your Posted Jobs" : "Available Jobs"} ({jobs.length})
                                    </h3>
                                    {jobs.length > 0 ? (
                                        <div className="space-y-4">
                                            {jobs.map(job => (
                                                <div key={job.id} className="bg-white rounded-lg p-4 shadow-sm">
                                                    <h4 className="font-bold text-gray-800">{job.title}</h4>
                                                    <p className="text-gray-600 text-sm mb-2">{job.description}</p>
                                                    <div className="space-y-1 text-sm text-gray-600">
                                                        <p><strong>Skills:</strong> {job.skills_required}</p>
                                                        <p><strong>Location:</strong> {job.location}</p>
                                                        <p><strong>Salary:</strong> {job.salary_range}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center py-8">
                                            <BriefcaseIcon />
                                            <h4 className="text-lg font-bold text-gray-800 mb-2">No Jobs Available</h4>
                                            <p className="text-gray-600">Jobs will appear here.</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                            <BottomNavigation activeScreen="jobs" onNavigate={handleBottomNavigation} />
                        </div>
                    </div>
                );
            }

            // Profile Screens
            if (screen === "employerProfile" || screen === "workerProfile") {
                const isEmployer = screen === "employerProfile";
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col h-screen bg-gray-50">
                            <div className={`${isEmployer ? "bg-blue-600" : "bg-green-600"} p-4 text-white`}>
                                <h1 className="text-xl font-bold text-center">My Profile</h1>
                            </div>
                            <div className="flex flex-col items-center mt-6">
                                <div className="w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center overflow-hidden">
                                    {currentUser?.profile_photo_url ? (
                                        <img src={currentUser.profile_photo_url} alt={currentUser.name} className="w-full h-full object-cover" />
                                    ) : (
                                        <UserIcon />
                                    )}
                                </div>
                                <h2 className="font-bold text-gray-800 mt-2 text-xl">{currentUser?.name || "User"}</h2>
                                <div className={`px-3 py-1 ${isEmployer ? "bg-blue-500" : "bg-green-500"} text-white text-xs rounded-full mt-2`}>
                                    {isEmployer ? "Employer" : "Worker"}
                                </div>
                            </div>
                            <div className="p-4 mt-4 space-y-4 flex-1 overflow-y-auto pb-20">
                                <div className="bg-white rounded-lg p-4 shadow-sm">
                                    <h3 className="font-bold text-gray-800 mb-3">Personal Information</h3>
                                    <div className="space-y-2">
                                        <p><strong>Email:</strong> {currentUser?.email || "Not set"}</p>
                                        <p><strong>Phone:</strong> {currentUser?.phone || "Not set"}</p>
                                        <p><strong>Location:</strong> {currentUser?.location || "Not set"}</p>
                                        {!isEmployer && <p><strong>Age:</strong> {currentUser?.age || "Not set"}</p>}
                                        {!isEmployer && <p><strong>Skills:</strong> {currentUser?.skills || "Not set"}</p>}
                                    </div>
                                </div>
                                <div className="bg-white rounded-lg p-4 shadow-sm">
                                    <button className="w-full p-3 bg-red-50 text-red-600 rounded-lg font-medium hover:bg-red-100 transition-colors" onClick={handleLogout}>
                                        Logout
                                    </button>
                                </div>
                            </div>
                            <BottomNavigation activeScreen="profile" onNavigate={handleBottomNavigation} />
                        </div>
                    </div>
                );
            }

            // Login Screens
            if (screen === "employerLogin" || screen === "workerLogin") {
                const isEmployer = screen === "employerLogin";
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col h-screen bg-gray-50">
                            <div className={`${isEmployer ? "bg-blue-600" : "bg-green-600"} p-4 text-white flex items-center`}>
                                <ArrowLeftIcon onClick={() => setScreen("landing")} />
                                <h1 className="text-xl font-bold flex-1 text-center">{isEmployer ? "Employer" : "Worker"} Login</h1>
                            </div>
                            <div className="flex flex-col items-center justify-center flex-1 p-4">
                                <div className="w-full max-w-sm">
                                    <div className="text-center mb-8">
                                        <div className={`w-16 h-16 ${isEmployer ? "bg-blue-100" : "bg-green-100"} rounded-full flex items-center justify-center mx-auto mb-4`}><UserIcon /></div>
                                        <h2 className="text-2xl font-bold text-gray-800">Welcome Back!</h2>
                                        <p className="text-gray-600 text-sm mt-2">Sign in to your {isEmployer ? "employer" : "worker"} account</p>
                                    </div>
                                    <div className="space-y-4">
                                        <div><label className="block text-gray-700 font-medium mb-2">Email Address</label><input type="email" placeholder="Enter your email" value={loginCredentials.email} onChange={(e) => setLoginCredentials({...loginCredentials, email: e.target.value})} className={`w-full p-3 border border-gray-300 rounded-lg focus:ring-2 ${isEmployer ? "focus:ring-blue-500" : "focus:ring-green-500"} focus:border-transparent`} onKeyPress={(e) => e.key === "Enter" && handleLogin()} /></div>
                                        <div><label className="block text-gray-700 font-medium mb-2">Password</label><input type="password" placeholder="Enter your password" value={loginCredentials.password} onChange={(e) => setLoginCredentials({...loginCredentials, password: e.target.value})} className={`w-full p-3 border border-gray-300 rounded-lg focus:ring-2 ${isEmployer ? "focus:ring-blue-500" : "focus:ring-green-500"} focus:border-transparent`} onKeyPress={(e) => e.key === "Enter" && handleLogin()} /></div>
                                        <button className={`w-full py-4 ${isEmployer ? "bg-blue-600 hover:bg-blue-700" : "bg-green-600 hover:bg-green-700"} text-white rounded-lg font-medium transition-colors`} onClick={handleLogin}>Sign In</button>
                                        <div className="text-center mt-4"><p className="text-gray-600 text-sm">Don't have an account?<button className={`${isEmployer ? "text-blue-600" : "text-green-600"} ml-1 font-medium`} onClick={() => setScreen(isEmployer ? "createEmployerAccount" : "createWorkerAccount")}>Sign up here</button></p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Create Employer Account Screen
            if (screen === "createEmployerAccount") {
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col h-screen bg-gray-50">
                            <div className="bg-blue-600 p-4 text-white flex items-center">
                                <ArrowLeftIcon onClick={() => setScreen("landing")} />
                                <h1 className="text-xl font-bold flex-1 text-center">Create Employer Account</h1>
                            </div>
                            <div className="p-4 overflow-y-auto">
                                <div className="text-center mb-6">
                                    <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3"><UserIcon /></div>
                                    <h2 className="text-lg font-bold text-gray-800">Join as an Employer</h2>
                                    <p className="text-gray-600 text-sm">Find reliable household help for your family</p>
                                </div>
                                <div className="space-y-4">
                                    <div><label className="block text-gray-700 font-medium mb-2">Full Name *</label><input type="text" name="name" placeholder="Enter your full name" value={registrationForm.name} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Email Address *</label><input type="email" name="email" placeholder="Enter your email" value={registrationForm.email} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Phone Number *</label><input type="tel" name="phone" placeholder="+254 712 345 678" value={registrationForm.phone} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Location *</label><input type="text" name="location" placeholder="City, Area (e.g., Westlands, Nairobi)" value={registrationForm.location} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Password *</label><input type="password" name="password" placeholder="Create a secure password (min 6 characters)" value={registrationForm.password} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Confirm Password *</label><input type="password" name="confirmPassword" placeholder="Confirm your password" value={registrationForm.confirmPassword} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">About Your Household (Optional)</label><textarea name="about" placeholder="Tell us about your family and what kind of help you're looking for..." value={registrationForm.about} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent" /></div>
                                    <button className="w-full py-4 bg-blue-600 text-white rounded-lg font-medium mt-6 hover:bg-blue-700 transition-colors" onClick={() => handleRegistration("employer")}>Create Employer Account</button>
                                    <div className="text-center mt-4"><p className="text-gray-600 text-sm">Already have an account?<button className="text-blue-600 ml-1 font-medium" onClick={() => setScreen("employerLogin")}>Login here</button></p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Create Worker Account Screen (Simplified for now)
            if (screen === "createWorkerAccount") {
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col h-screen bg-gray-50">
                            <div className="bg-green-600 p-4 text-white flex items-center">
                                <ArrowLeftIcon onClick={() => setScreen("landing")} />
                                <h1 className="text-xl font-bold flex-1 text-center">Create Worker Account</h1>
                            </div>
                            <div className="p-4 overflow-y-auto">
                                <div className="text-center mb-6">
                                    <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3"><UserIcon /></div>
                                    <h2 className="text-lg font-bold text-gray-800">Join as a Domestic Worker</h2>
                                    <p className="text-gray-600 text-sm">Connect with families who need your skills</p>
                                </div>
                                <div className="space-y-4">
                                    <div><label className="block text-gray-700 font-medium mb-2">Full Name *</label><input type="text" name="name" placeholder="Enter your full name" value={registrationForm.name} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Age *</label><input type="number" name="age" placeholder="Enter your age" min="18" max="70" value={registrationForm.age} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Email Address *</label><input type="email" name="email" placeholder="Enter your email" value={registrationForm.email} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Phone Number *</label><input type="tel" name="phone" placeholder="+254 712 345 678" value={registrationForm.phone} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Location *</label><input type="text" name="location" placeholder="City, Area (e.g., Kiambu, Nairobi)" value={registrationForm.location} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Skills *</label><input type="text" name="skills" placeholder="e.g., Cleaning, Cooking, Childcare, Gardening" value={registrationForm.skills} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Experience *</label><input type="text" name="experience" placeholder="e.g., 5 years as housekeeper" value={registrationForm.experience} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Expected Monthly Salary *</label><input type="text" name="monthlySalary" placeholder="e.g., KSh 25,000 - 35,000" value={registrationForm.monthlySalary} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Password *</label><input type="password" name="password" placeholder="Create a secure password (min 6 characters)" value={registrationForm.password} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <div><label className="block text-gray-700 font-medium mb-2">Confirm Password *</label><input type="password" name="confirmPassword" placeholder="Confirm your password" value={registrationForm.confirmPassword} onChange={handleRegistrationFormChange} className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" required /></div>
                                    <button className="w-full py-4 bg-green-600 text-white rounded-lg font-medium mt-6 hover:bg-green-700 transition-colors" onClick={() => handleRegistration("worker")}>Create Worker Account</button>
                                    <div className="text-center mt-4"><p className="text-gray-600 text-sm">Already have an account?<button className="text-green-600 ml-1 font-medium" onClick={() => setScreen("workerLogin")}>Login here</button></p></div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Home Screens
            if (screen === "employerHome") {
                const workers = getWorkers();
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col h-screen bg-gray-50">
                            <div className="bg-blue-600 p-4 text-white"><h1 className="text-xl font-bold text-center">Domestic Services App</h1></div>
                            <div className="m-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100">
                                <h2 className="text-lg font-bold text-gray-800">Welcome, {currentUser?.name || "User"}!</h2>
                                <p className="text-gray-600">Employer Dashboard</p>
                            </div>
                            <div className="m-4">
                                <h3 className="text-lg font-bold text-gray-800 mb-3">Quick Actions</h3>
                                <div className="flex justify-between">
                                    <div className="w-40 h-28 bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:shadow-md transition-shadow" onClick={() => setScreen("postJob")}>
                                        <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mb-2"><PlusIcon /></div>
                                        <span className="text-gray-800 font-medium">Post Job</span>
                                    </div>
                                    <div className="w-40 h-28 bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg flex flex-col items-center justify-center cursor-pointer hover:shadow-md transition-shadow" onClick={() => setScreen("viewWorkers")}>
                                        <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center mb-2"><UserIcon /></div>
                                        <span className="text-gray-800 font-medium">View Workers</span>
                                    </div>
                                </div>
                            </div>
                            <div className="m-4 pb-20">
                                <h3 className="text-lg font-bold text-gray-800 mb-3">Available Workers ({workers.length})</h3>
                                {workers.length > 0 ? (
                                    <div className="space-y-4">
                                        {workers.slice(0, 3).map(worker => (
                                            <div key={worker.id} className="p-4 bg-white rounded-lg shadow-sm flex items-center">
                                                <div className="w-12 h-12 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center"><UserIcon /></div>
                                                <div className="ml-4 flex-1">
                                                    <h4 className="font-bold text-gray-800">{worker.name}</h4>
                                                    <p className="text-gray-600 text-sm">{worker.skills}</p>
                                                </div>
                                                <button className="px-4 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors">View</button>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="text-center py-8 bg-white rounded-lg">
                                        <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4"><UserIcon /></div>
                                        <h4 className="text-lg font-bold text-gray-800 mb-2">No Workers Available</h4>
                                        <p className="text-gray-600">Workers will appear here once they create profiles.</p>
                                    </div>
                                )}
                            </div>
                            <BottomNavigation activeScreen="home" onNavigate={handleBottomNavigation} />
                        </div>
                    </div>
                );
            }

            if (screen === "workerHome") {
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col h-screen bg-gray-50">
                            <div className="bg-green-600 p-4 text-white"><h1 className="text-xl font-bold text-center">Worker Dashboard</h1></div>
                            <div className="flex flex-col items-center mt-6">
                                <div className="w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center"><UserIcon /></div>
                                <h2 className="font-bold text-gray-800 mt-2 text-xl">{currentUser?.name || "Worker"}</h2>
                                <div className="px-3 py-1 bg-green-500 text-white text-xs rounded-full mt-2">Available</div>
                            </div>
                            <div className="p-4 mt-4 pb-20 overflow-y-auto">
                                <h3 className="text-lg font-bold text-gray-800 mb-4">Summary</h3>
                                <div className="space-y-4">
                                    <div className="bg-white rounded-lg p-4 shadow-sm"><h4 className="font-bold text-gray-800">Available Jobs</h4><p className="text-gray-600">{jobs.length}</p></div>
                                    <div className="bg-white rounded-lg p-4 shadow-sm"><h4 className="font-bold text-gray-800">Messages</h4><p className="text-gray-600">{conversations.length}</p></div>
                                    <div className="bg-white rounded-lg p-4 shadow-sm"><h4 className="font-bold text-gray-800">Your Skills</h4><p className="text-gray-600">{currentUser?.skills || "Not set"}</p></div>
                                </div>
                            </div>
                            <BottomNavigation activeScreen="home" onNavigate={handleBottomNavigation} />
                        </div>
                    </div>
                );
            }

            // Simplified screens for remaining functionality
            if (screen === "messages" || screen === "postJob" || screen === "viewWorkers") {
                return (
                    <div className="mobile-container">
                        <div className="flex flex-col items-center justify-center p-4 h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                            <div className="text-center">
                                <h1 className="text-2xl font-bold text-blue-600 mb-4">Feature Coming Soon</h1>
                                <p className="text-gray-600 mb-8">This feature is under development.</p>
                                <button className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors" onClick={() => setScreen(userType === "employer" ? "employerHome" : "workerHome")}>Go Back</button>
                            </div>
                        </div>
                    </div>
                );
            }

            // Default fallback
            return (
                <div className="mobile-container">
                    <div className="flex flex-col items-center justify-center p-4 h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                        <div className="text-center">
                            <h1 className="text-4xl font-bold text-blue-600 mb-4">Domestic Services App</h1>
                            <p className="text-gray-600 mb-8 text-lg">Connect domestic workers with employers</p>
                            <button className="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors" onClick={() => setScreen("landing")}>Go to Home</button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
